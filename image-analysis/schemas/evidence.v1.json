{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.org/schemas/evidence.v1.json",
  "title": "Evidence + Analyses (V1)",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "evidence", "analyses"],
  "properties": {
    "schema_version": { "type": "string", "const": "1.0.0" },
    "case_id": { "type": "string" },
    "evidence": {
      "type": "object",
      "additionalProperties": false,
      "required": ["evidence_id", "sha256", "mime_type", "bytes", "ingested_at", "source_path"],
      "properties": {
        "evidence_id": { "type": "string" },
        "sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "mime_type": { "type": "string" },
        "bytes": { "type": "integer", "minimum": 1 },
        "width_px": { "type": "integer", "minimum": 1 },
        "height_px": { "type": "integer", "minimum": 1 },
        "phash": { "type": "string" },
        "ingested_at": { "type": "string", "format": "date-time" },
        "source_path": { "type": "string" }
      }
    },
    "chain_of_custody": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["ts", "actor", "action"],
        "properties": {
          "ts": { "type": "string", "format": "date-time" },
          "actor": { "type": "string" },
          "action": { "type": "string" },
          "note": { "type": "string" }
        }
      }
    },
    "analyses": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["analysis_id", "created_at", "model", "parameters", "outputs", "confidence_overall"],
        "properties": {
          "analysis_id": { "type": "string" },
          "created_at": { "type": "string", "format": "date-time" },
          "model": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "revision"],
            "properties": {
              "name": { "type": "string" },
              "revision": { "type": "string" }
            }
          },
          "parameters": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "temperature": { "type": "number", "maximum": 0 },
              "prompt_hash": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
              "token_usage_in": { "type": "integer" },
              "token_usage_out": { "type": "integer" }
            }
          },
          "outputs": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "summary": { "type": "string" },
              "objects": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["label"],
                  "properties": {
                    "label": { "type": "string" },
                    "bbox": {
                      "type": "array",
                      "minItems": 4,
                      "maxItems": 4,
                      "items": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                      }
                    },
                    "confidence": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1
                    }
                  }
                }
              },
              "text_found": { "type": "string" },
              "risk_flags": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["low_quality", "tampering_suspected", "ocr_ambiguous", "nsfw", "pii"]
                }
              }
            }
          },
          "confidence_overall": { "type": "number", "minimum": 0, "maximum": 1 }
        }
      }
    }
  }
}
